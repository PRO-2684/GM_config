# `GM_config`

[English](./README.md) | ç®€ä½“ä¸­æ–‡

[![GitHub Downloads (all assets, all releases)](https://img.shields.io/github/downloads/PRO-2684/GM_config/total?logo=github)](https://github.com/PRO-2684/GM_config/releases)
[![](https://img.shields.io/badge/Crazy%20Thur.-V%20me%2050-red?logo=kfc)](https://greasyfork.org/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBaWZvIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--10e04ed7ed56ae18d22cec6d675b34fd579cecab/wechat.jpeg?locale=zh-CN)
[![GM_config Badge](https://img.shields.io/badge/%E2%9A%99%EF%B8%8F-GM__config-blue)](https://github.com/PRO-2684/GM_config/)

ç®€å•è€Œåˆå¼ºå¤§çš„ç”¨æˆ·è„šæœ¬é…ç½®åº“ã€‚ ([GitHub](https://github.com/PRO-2684/GM_config) | [Greasy Fork](https://greasyfork.org/scripts/470224))

## ğŸ‰ ç‰¹æ€§

- åˆ©ç”¨äº†ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨æ‰€æä¾›çš„ **é…ç½®èœå•**
- é…ç½®ä¿®æ”¹å **è‡ªåŠ¨æ›´æ–°èœå•**ï¼ˆæ— è®ºç”±ç”¨æˆ·æˆ–è„šæœ¬ä¿®æ”¹ï¼‰
- æ”¯æŒ **ç›‘å¬é…ç½®è·å–/ä¿®æ”¹äº‹ä»¶**
- æ”¯æŒ **å¤šæ ‡ç­¾é¡µåŒæ­¥**
- æ”¯æŒ **æ–‡ä»¶å¤¹**ï¼ˆåµŒå¥—é…ç½®é¡¹ï¼‰
- è‡ªåŠ¨/æ‰‹åŠ¨æ³¨å†Œèœå•
- **è‡ªå®šä¹‰** ç¨‹åº¦é«˜
    - è‡ªå®šä¹‰é…ç½®è¾“å…¥æ–¹å¼ (`prop.input`)
    - è‡ªå®šä¹‰è¾“å…¥æ•°æ®å¤„ç†æ–¹å¼ (`prop.processor`)
    - è‡ªå®šä¹‰èœå•é¡¹å±•ç°æ–¹å¼ (`prop.formatter`)
- è‡ªåŠ¨åˆ é™¤ä¸é»˜è®¤å€¼ç›¸åŒçš„ç”¨æˆ·é…ç½®ï¼Œé™ä½å­˜å‚¨å¼€é”€

<details><summary>ğŸ–¼ï¸ ç¤ºä¾‹æˆªå›¾</summary>

![test_config](images/test_config.jpg)

</details>

## ğŸ¤” å…ˆå†³æ¡ä»¶

è¿™ä¸ªåº“éœ€è¦ä»¥ä¸‹æƒé™ï¼š

- `GM_setValue`: ä¿å­˜é…ç½®
- `GM_getValue`: è·å–é…ç½®
- `GM_deleteValue`: è‡ªåŠ¨åˆ é™¤é…ç½® (å¯é€‰ï¼Œç»™äºˆååº“ä¼šè‡ªåŠ¨åˆ é™¤ä¸é»˜è®¤å€¼ç›¸åŒçš„ç”¨æˆ·é…ç½®)
- `GM_registerMenuCommand`: æ³¨å†Œèœå•
- `GM_unregisterMenuCommand`: æ›´æ–°èœå•
- `GM_addValueChangeListener`: ç›‘å¬é…ç½®å˜åŒ–

ä½ å¯ä»¥ä»ä»¥ä¸‹å‡ ç§æ–¹æ³•ä¸­é€‰æ‹©ä¸€ç§ï¼Œä»¥å°†æ­¤åº“åŒ…å«åœ¨ä½ çš„è„šæœ¬ä¸­ï¼š

| Source         | Original | Minified |
| -------------- | -------- | -------- |
| [GitHub Release](https://github.com/PRO-2684/GM_config/releases) | ğŸŸ¢      | ğŸŸ¢       |
| [GitHub Raw](https://github.com/PRO-2684/GM_config/blob/main/config.js)     | ğŸŸ¢      | ğŸ”´       |
| [GreasyFork](https://greasyfork.org/scripts/470224)     | ğŸ”´      | <span title="æ¯å¤©æ£€æŸ¥ä¸€æ¬¡æ›´æ–°">ğŸŸ¡*</span>      |

GitHub Release (Minified) æ˜¯æœ€æ¨èçš„æºã€‚ä»¥æ­¤ä¸ºä¾‹ï¼Œä½ å¯ä»¥åƒè¿™æ ·å°†æ­¤åº“åŒ…å«åœ¨ä½ çš„è„šæœ¬ä¸­ï¼š

```javascript
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_addValueChangeListener
// @require      https://github.com/PRO-2684/GM_config/releases/download/<version>/config.min.js
```

å…¶ä¸­ `<version>` æ˜¯ä½ æƒ³è¦ä½¿ç”¨çš„ç‰ˆæœ¬ (ä¾‹å¦‚ `v1.2.0`)ã€‚è‹¥åªä½œæµ‹è¯•ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ `@require` [æœ€æ–°ç‰ˆ](https://github.com/PRO-2684/GM_config/releases/latest/download/config.min.js)ã€‚

è‹¥ä½ æƒ³å°†è„šæœ¬å‘å¸ƒåˆ° GreasyFork ç­‰ç½‘ç«™ï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ  [**å­èµ„æºå®Œæ•´æ€§** æ£€æŸ¥](https://www.tampermonkey.net/documentation.php#api:Subresource_Integrity)ã€‚åªéœ€åœ¨ `@require` çš„ URL åæ·»åŠ  `#md5=<md5>`ï¼Œå…¶ä¸­ `<md5>` æ˜¯æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ã€‚ä½ å¯ä»¥åœ¨å‘å¸ƒé¡µé¢æ‰¾åˆ°è®¡ç®—çš„å“ˆå¸Œå€¼ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

é¦–å…ˆï¼Œä½ éœ€è¦ä¸€ä¸ª `Object` æ¥æè¿°ä½ çš„é…ç½®çš„ç»“æ„ã€‚è¿™è¢«ç§°ä¸ºâ€œé…ç½®æè¿°â€ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```javascript
const configDesc = {
    price: { // é…ç½®é¡¹ idï¼Œä¹Ÿè¢«ç§°ä¸º "prop"
        name: "Price", // æ˜¾ç¤ºåç§°
        type: "int", // é…ç½®é¡¹ç±»å‹
        value: 100 // é»˜è®¤å€¼
    },
    name: {
        name: "Name",
        type: "str",
        value: "John Doe"
    },
};
```

ä½ å¯èƒ½æƒ³è¦é™åˆ¶æ•´æ•°çš„èŒƒå›´ã€‚æ²¡é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ `min` å’Œ `max` å±æ€§æ¥å®ç°ï¼š

```javascript
const configDesc = {
    price: {
        name: "Price",
        type: "int",
        value: 100,
        min: 1, // ä¸–ç•Œä¸Šæ²¡æœ‰å…è´¹çš„åˆé¤
        max: 1000 // æ— æ³•æ‰¿å—çš„ä»·æ ¼
    },
    // ...
};
```

è¿™æ ·ï¼Œä½ å°±æŠŠè¿™ä¸ªå€¼çš„èŒƒå›´é™åˆ¶åœ¨äº† $[1, 1000]$ã€‚å¦å¤–ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæˆ–è€…è¯´å¼€å…³ã€‚ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å·²ç»ä¸ºä½ åšå¥½äº†å‡†å¤‡ - åªéœ€è¦å°† `type` è®¾ç½®ä¸º `"bool"` å³å¯ã€‚æœ‰å…³æ”¯æŒçš„ç±»å‹åŠå…¶ç”¨æ³•çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… [æ–‡æ¡£](#proptype)ã€‚

å®šä¹‰å¥½é…ç½®æè¿°åï¼Œæ˜¯æ—¶å€™è¯¥æ³¨å†Œå®ƒäº†ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š

```javascript
const config = new GM_config(configDesc); // æ³¨å†Œé…ç½®èœå•
```

ååˆ†ç®€å•ï¼Œå¯¹å§ï¼Ÿç°åœ¨ï¼Œä½ å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªé…ç½®äº†ã€‚é€šå¸¸æ¥è¯´ï¼Œä½ ä¼šæƒ³è¦ **æŸ¥è¯¢** é…ç½®ï¼Œåœ¨ç‰¹å®šçš„æƒ…æ™¯ä¸‹ä¼šæƒ³è¦ **ä¿®æ”¹** é…ç½®ï¼Œå¹¶ä¸”ä¸ºäº†åŠ¨æ€å“åº”è¦ **ç›‘å¬** é…ç½®çš„å˜åŒ–ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š

```javascript
console.log(config.get("price")); // æŸ¥è¯¢é…ç½®
config.set("price", 100); // ä¿®æ”¹é…ç½® (å±•ç¤ºçš„èœå•é¡¹ä¼šè‡ªåŠ¨æ›´æ–°)
config.addEventListener("set", (e) => {
    const { prop, before, after } = e.detail;
    console.log(`é…ç½®é¡¹ ${prop} ä» ${before} æ›´æ”¹ä¸º ${after}`);
});
```

ç°åœ¨ä½ å·²ç»æˆåŠŸåœ°ä¸ºè„šæœ¬è®¾ç½®äº†ä¸€ä¸ªç®€å•çš„é…ç½®èœå•ï¼Œæ˜¯æ—¶å€™æ·±å…¥ [æ–‡æ¡£](#-æ–‡æ¡£) ä»¥æ¢ç´¢æ›´é«˜çº§çš„åŠŸèƒ½äº†ã€‚

## ğŸ“– æ–‡æ¡£

### ç¡®è®¤ç‰ˆæœ¬

```javascript
console.log(GM_config.version); // *è¾“å‡ºç‰ˆæœ¬*
```

### é…ç½®æè¿°

ä½¿ç”¨è¿™ä¸ªåº“çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªé…ç½®æè¿°ã€‚é…ç½®æè¿°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒçš„æ¯ä¸ªå±æ€§ (é™¤äº†å¯èƒ½çš„ `$default` å¤–) éƒ½æ˜¯ä¸€ä¸ªé…ç½®é¡¹çš„ idã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸å…è®¸ `.` å‡ºç°åœ¨é…ç½®é¡¹çš„ id ä¸­ã€‚

#### `$default`

é€šè¿‡ä½¿ç”¨ `$default`ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå¤§é‡ç›¸åŒç±»å‹çš„é…ç½®é¡¹ã€‚è‹¥æœªåœ¨é…ç½®æè¿°ä¸­æä¾› `$default`ï¼Œåˆ™ä¼šå¯¹é…ç½®é¡¹ä¸­æœªæŒ‡å®šçš„å±æ€§ä½¿ç”¨å¦‚ä¸‹å€¼ï¼š

```javascript
{ // ä¼˜å…ˆçº§ï¼šæœ€ä½
    input: "prompt",
    processor: "same",
    formatter: "normal"
}
```

è‹¥ä½ æƒ³è¦ä¿®æ”¹é»˜è®¤å€¼ï¼Œä½ å¯ä»¥åœ¨é…ç½®æè¿°ä¸­æä¾› `$default` ä»è€Œè¦†ç›–ä¸Šè¿°é»˜è®¤å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è¿™é‡ŒæŒ‡å®š `prop.type` å¹¶ä¸ä¼šç”Ÿæ•ˆï¼›å­æ–‡ä»¶å¤¹ä¼š **ç»§æ‰¿** `$default` å±æ€§ã€‚ä¾‹å¦‚ï¼š

```javascript
const configDesc = {
    "$default": { // ä¼˜å…ˆçº§ï¼šä½
        value: true,
        input: "current",
        processor: "not",
        formatter: "boolean"
    },
    switch_true: {
        name: "Switch true"
    },
    switch_false: {
        name: "Switch false",
        value: false // ä¼˜å…ˆçº§ï¼šæœ€é«˜
    }
}
```

ä½†æ˜¯ï¼Œé€šå¸¸æ¥è¯´ï¼Œåç»­æåˆ°çš„ `prop.type` æ‰æ˜¯ç”¨äºåˆ›å»ºç›¸ä¼¼é…ç½®é¡¹çš„æœ€ä½³é€‰æ‹©ï¼Œè€Œ `$default` åªè¢«ç”¨äºå°† `autoClose` è®¾ç½®ä¸º `false`ï¼š

```javascript
const configDesc = {
    "$default": {
        autoClose: false
    },
    // ...
}
```

#### `prop.type`

é…ç½®é¡¹çš„ç±»å‹ï¼Œç”¨äºå¿«é€Ÿè®¾ç½®å¸¸è§çš„å±æ€§é›†ã€‚å½“å‰æ”¯æŒçš„ç±»å‹æœ‰ï¼š

- `str`ï¼šå­—ç¬¦ä¸²ï¼Œé»˜è®¤ä¸º `""`
- `bool`ï¼šå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º `false`
- `int`ï¼šæ•´æ•°ï¼Œé»˜è®¤ä¸º `0`
    - è‹¥æŒ‡å®š `prop.min`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å¤§äºç­‰äº `prop.min`
    - è‹¥æŒ‡å®š `prop.max`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å°äºç­‰äº `prop.max`
- `float`ï¼šæµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¸º `0.0`
    - è‹¥æŒ‡å®š `prop.min`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å¤§äºç­‰äº `prop.min`
    - è‹¥æŒ‡å®š `prop.max`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å°äºç­‰äº `prop.max`
- `enum`ï¼šæšä¸¾
    - `prop.options`ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä»£è¡¨ä¸€ç³»åˆ—æ‰€å±•ç¤ºçš„å¯é€‰å€¼ï¼Œé»˜è®¤ä¸º `["A", "B", "C"]`
    - ç”¨æˆ·å¯ä»¥é€šè¿‡ç‚¹å‡»èœå•é¡¹ï¼Œåœ¨é€‰é¡¹é—´å¾ªç¯åˆ‡æ¢
    - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`prop.options` åªæ˜¯åœ¨ç”¨æˆ·è§†è§’ä¸‹çš„å±•ç¤ºï¼Œå®é™…ä¸Šé…ç½®é¡¹æ‰€ä½¿ç”¨çš„å€¼æ˜¯æ­¤æ•°ç»„çš„ **ç´¢å¼•**ï¼ˆä» 0 è‡³ `prop.options.length - 1` å¾ªç¯ï¼‰
    - ä½ åº”è¯¥ç»™ `prop.value` è®¾ç½®ä¸€ä¸ªå°äº `prop.options.length` çš„éè´Ÿæ•´æ•°ï¼Œè‹¥æœªæŒ‡å®šåˆ™é»˜è®¤ä¸º `0`
- `action`ï¼šç‚¹å‡»æ—¶è°ƒç”¨å‡½æ•°
    - ä½ ä¸åº”è¯¥è¦†ç›–æ­¤ç±»å‹çš„ `prop.input` å’Œ `prop.processor` å±æ€§
    - ä¸ºå®ç°å›è°ƒï¼Œè¯·ä½¿ç”¨ `config.addEventListener` ç›‘å¬æ­¤å±æ€§çš„ `get` äº‹ä»¶
- `folder`ï¼šä¸€ä¸ªå«æœ‰å…¶å®ƒé…ç½®é¡¹çš„æ–‡ä»¶å¤¹
    - ä½ éœ€è¦è¦†ç›– `prop.items` æ¥åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºé…ç½®é¡¹ï¼Œå…¶æ ¼å¼ä¸é¡¶å±‚é…ç½®æè¿° `configDesc` ç›¸åŒ
    - ä½ å¯ä»¥åœ¨æ–‡ä»¶å¤¹å†…ä½¿ç”¨ `$default`
    - ä½ å¯ä»¥éšä½ å–œæ¬¢åµŒå¥—ä»»æ„å¤šçš„æ–‡ä»¶å¤¹
    - é€šè¿‡ `prop.folderDisplay` æ¥æ§åˆ¶æ–‡ä»¶å¤¹çš„å±•ç°æ–¹å¼
        - `prefix`ï¼šå­æ–‡ä»¶å¤¹åç§°å‰ç¼€ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²
        - `suffix`ï¼šå­æ–‡ä»¶å¤¹åç§°åç¼€ï¼Œé»˜è®¤ä¸º ` >`
        - `parentText`ï¼šè¿”å›ä¸Šä¸€çº§çš„æ–‡æœ¬ï¼Œé»˜è®¤ä¸º `< Back`
        - `parentTitle`ï¼šè¿”å›ä¸Šä¸€çº§çš„æ ‡é¢˜ï¼Œé»˜è®¤ä¸º `Return to parent folder`
    - é€šè¿‡å¥ç‚¹è®¿é—®åµŒå¥—çš„é…ç½®é¡¹ï¼Œä¾‹å¦‚ï¼š
        - `config.get("folder1.folder2.item")`
        - `config.proxy["folder1.folder2.item"]`
        - `config.proxy.folder1.folder2.item`
        - `config.proxy["folder1.folder2"].item`

ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒä»¬ï¼š

```javascript
const configDesc = {
    switch_true: {
        name: "Switch true",
        type: "bool" // ä¼˜å…ˆçº§ï¼šé«˜
    },
    switch_false: {
        name: "Switch false",
        type: "bool", // ä¼˜å…ˆçº§ï¼šé«˜
        value: false // ä¼˜å…ˆçº§ï¼šæœ€é«˜
    }
}
```

#### `prop.name`

é…ç½®é¡¹çš„æ˜¾ç¤ºåç§°ã€‚å¿…é¡»æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

#### `prop.value`

é…ç½®é¡¹çš„é»˜è®¤å€¼ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼ã€‚ä½ éœ€è¦è€ƒè™‘å…¶åˆæ³•æ€§ï¼Œå› ä¸ºæ­¤åº“ä¸ä¼šéªŒè¯é»˜è®¤å€¼çš„åˆæ³•æ€§ã€‚

#### `prop.input`

> `(prop, orig, desc) => input`

é…ç½®é¡¹çš„è¾“å…¥æ–¹å¼ã€‚å¯ä»¥æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå†…ç½®è¾“å…¥æ–¹å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼ˆå½“èœå•é¡¹è¢«ç‚¹å‡»æ—¶è§¦å‘ï¼‰ã€‚è‹¥ `prop.input` å’Œ `$default.input` å‡æœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ `prompt`ï¼Œå³å¼¹å‡ºå¯¹è¯æ¡†è¯¢é—®è¾“å…¥ã€‚æ³¨æ„ï¼Œâ€œç”¨æˆ·è¾“å…¥å€¼â€ä¹Ÿå¯ä»¥å®é™…ä¸Šå¹¶éç”±ç”¨æˆ·è¾“å…¥ï¼Œè€Œæ˜¯ç”±è„šæœ¬æä¾›çš„ã€‚ä¾‹å¦‚å†…ç½®è¾“å…¥æ–¹å¼ `current`ã€‚

æ­¤å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š

- `prop`ï¼šé…ç½®é¡¹çš„ id
- `orig`ï¼šå½“å‰å€¼
- `desc`ï¼šæ­¤é…ç½®é¡¹çš„é…ç½®æè¿°ï¼ˆ`desc.` ä¸ `prop.` è¡¨è¾¾çš„å«ä¹‰ç›¸åŒï¼‰

å†…ç½®è¾“å…¥å‡½æ•°ï¼š

- `prompt`ï¼šå¼¹å‡ºå¯¹è¯æ¡†è¯¢é—®è¾“å…¥ï¼ˆé»˜è®¤ï¼‰
- `current`ï¼šä½¿ç”¨å½“å‰å€¼ä½œä¸ºè¾“å…¥ï¼ˆå¸¸ä¸ `prop.processor=not` é…åˆä½¿ç”¨ï¼Œç”¨äºå¼€å…³ï¼›æˆ–ä¸è‡ªå®šä¹‰çš„ `processor` é…åˆä½¿ç”¨ï¼Œæ„æˆç”Ÿæˆå™¨ï¼‰
- `action`ï¼šæ´¾å‘ `get` äº‹ä»¶ï¼Œè¿”å›åŸå€¼ï¼ˆå†…éƒ¨ç”¨äº `action` ç±»å‹ï¼‰
- `folder`ï¼šè¿›å…¥ç”±é…ç½®é¡¹ id æŒ‡å®šçš„æ–‡ä»¶å¤¹ã€‚åœ¨æ­¤ä¹‹åï¼Œæ´¾å‘ `get` äº‹ä»¶ï¼Œè¿”å›åŸå€¼ï¼ˆå†…éƒ¨ç”¨äº `folder` ç±»å‹ï¼‰

#### `prop.processor`

> `(prop, input, desc) => stored`

å¤„ç†ç”¨æˆ·è¾“å…¥å€¼ï¼Œè¿”å›åº”è¢«å­˜å‚¨çš„å€¼ã€‚å¯ä»¥æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå†…ç½®å¤„ç†å™¨ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ã€‚è‹¥ç”¨æˆ·è¾“å…¥çš„å€¼ä¸åˆæ³•ï¼Œå¤„ç†å™¨åº”è¯¥**æŠ›å‡ºé”™è¯¯**ã€‚è‹¥ `prop.processor` å’Œ `$default.processor` å‡æœªæŒ‡å®šï¼Œå°†é»˜è®¤ä½¿ç”¨ `same` å¤„ç†å™¨ï¼Œå³ç›´æ¥è¿”å›ç”¨æˆ·è¾“å…¥ã€‚å¸¸è§çš„ä½¿ç”¨æƒ…å†µæ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°æˆ–è€…æµ®ç‚¹æ•°ã€‚

æ­¤å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š

- `prop`ï¼šé…ç½®é¡¹çš„ id
- `input`ï¼šç”¨æˆ·è¾“å…¥çš„å€¼
- `desc`ï¼šæ­¤é…ç½®é¡¹çš„é…ç½®æè¿°

å†…ç½®å¤„ç†å™¨ï¼š

- `same`ï¼šç›´æ¥è¿”å›ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²
- `not`ï¼šå–åï¼ˆå¸¸ä¸ `prop.input=current` é…åˆä½¿ç”¨ï¼Œç”¨äºå¼€å…³ï¼‰
- `int`ï¼šè½¬æ¢ä¸ºåœ¨èŒƒå›´å†…çš„æ•´æ•°ï¼ˆè‹¥æŒ‡å®šï¼‰
    - è‹¥æŒ‡å®š `prop.min`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å¤§äºç­‰äº `prop.min`
    - è‹¥æŒ‡å®š `prop.max`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å°äºç­‰äº `prop.max`
- `float`ï¼šè½¬æ¢ä¸ºåœ¨èŒƒå›´å†…çš„æµ®ç‚¹æ•°ï¼ˆè‹¥æŒ‡å®šï¼‰
    - è‹¥æŒ‡å®š `prop.min`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å¤§äºç­‰äº `prop.min`
    - è‹¥æŒ‡å®š `prop.max`ï¼Œåˆ™æ£€æŸ¥å€¼æ˜¯å¦å°äºç­‰äº `prop.max`
- `enum`ï¼šå‘è¾“å…¥åŠ  1 å¹¶å…³äº `prop.options.length` å–æ¨¡ï¼ˆå†…éƒ¨ç”¨äº `enum` ç±»å‹ï¼‰

#### `prop.formatter`

> `(prop, value, desc) => string`

æ§åˆ¶èœå•é¡¹çš„æ˜¾ç¤ºæ–‡æœ¬ã€‚å±•ç°æ–¹å¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå†…ç½®å±•ç°æ–¹å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ã€‚è‹¥ `prop.formatter` å’Œ `$default.formatter` å‡æœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨ `normal` å±•ç°æ–¹å¼ã€‚

æ­¤å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š

- `prop`ï¼šé…ç½®é¡¹çš„ id
- `value`ï¼šé…ç½®é¡¹çš„å€¼
- `desc`ï¼šæ­¤é…ç½®é¡¹çš„é…ç½®æè¿°

å†…ç½®å±•ç°æ–¹å¼ï¼š

- `normal`ï¼šä»¥ `name: value` çš„å½¢å¼å±•ç°
- `boolean`ï¼šé’ˆå¯¹å¸ƒå°”å€¼çš„å±•ç°æ–¹å¼ - `true` æ˜¾ç¤ºä¸º `name: âœ”`ï¼Œ`false` æ˜¾ç¤ºä¸º `name: âœ˜`
- `enum`ï¼šä»¥ `name: option` çš„å½¢å¼å±•ç°ï¼Œå…¶ä¸­ `option` ä¸º `prop.options[value]`ï¼ˆå†…éƒ¨ç”¨äº `enum` ç±»å‹ï¼‰
- `name_only`: ä»…æ˜¾ç¤ºåç§°ï¼Œä¸æ˜¾ç¤ºå€¼ï¼ˆå†…éƒ¨ç”¨äº `action` ç±»å‹ï¼‰
- `folder`: ä½¿ç”¨ `prop.folderDisplay.prefix` å’Œ `prop.folderDisplay.suffix` åŒ…è£¹åç§°ï¼ˆå†…éƒ¨ç”¨äº `folder` ç±»å‹ï¼‰

#### `prop.hidden`

> `boolean`

æ˜¯å¦éšè—æ­¤é…ç½®é¡¹ã€‚è‹¥è®¾ä¸º `true`ï¼Œåˆ™ä¸ä¼šåœ¨èœå•ä¸­æ˜¾ç¤ºæ­¤é…ç½®é¡¹ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥é€šè¿‡ `config.get` å’Œ `config.set` æ¥è®¿é—®æˆ–ä¿®æ”¹å®ƒã€‚

#### å…¶å®ƒ Tampermonkey æä¾›çš„å±æ€§

æ”¯æŒ `prop.accessKey`, `prop.autoClose`, `prop.title` (è¦æ±‚ TM >=4.20.0)ã€‚å¦‚æœæä¾›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è°ƒç”¨ï¼Œä¼ å…¥å‚æ•°ä¸º `prop`, `value` å’Œ `desc`ï¼Œå°±åƒè‡ªå®šä¹‰ `prop.formatter` ä¸€æ ·ã€‚å®ƒçš„è¿”å›å€¼å°†è¢«ä¼ é€’ç»™ Tampermonkeyã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [Tampermonkey æ–‡æ¡£](https://www.tampermonkey.net/documentation.php#api:GM_registerMenuCommand)ã€‚

#### ä¼˜å…ˆçº§

å±æ€§çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. ä½ ä¸ºé…ç½®é¡¹æ˜ç¡®è®¾ç½®çš„å±æ€§
2. `type` éšå«çš„å±æ€§
3. ä½ ä¸ºæ­¤æ–‡ä»¶å¤¹çš„ `$default` è®¾ç½®çš„å±æ€§
4. è®¡ç®—åçˆ¶æ–‡ä»¶å¤¹çš„ `$default`
5. `$default` çš„é»˜è®¤å€¼

### æ³¨å†Œé…ç½®èœå•

å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªé…ç½®æè¿°åï¼Œä½ å¯ä»¥ä½¿ç”¨ `GM_config` æ„é€ å‡½æ•°æ¥å°†å…¶æ³¨å†Œä¸ºé…ç½®èœå•ã€‚å®ƒæ¥å—å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š

- `configDesc`ï¼šé…ç½®æè¿°
- `options`ï¼šé€‰é¡¹ï¼ˆå¯é€‰ï¼‰
    - `immediate`ï¼šæ˜¯å¦ç«‹å³æ³¨å†Œèœå•
        - è‹¥ä¸º `true`ï¼Œåˆ™ä¼šç«‹å³æ³¨å†Œèœå•ï¼ˆé»˜è®¤ï¼‰
        - è‹¥ä¸º `false`ï¼Œéœ€è¦ç”¨æˆ·ç‚¹å‡» `Show configuration` åæ‰ä¼šæ³¨å†Œé…ç½®èœå•
    - `debug`ï¼šæ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ã€‚è‹¥ä¸º `true`ï¼Œä¼šè¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚é»˜è®¤ä¸º `false`ã€‚ï¼ˆéšæ—¶å¯ä»¥é€šè¿‡ `config.debug` æ¥ä¿®æ”¹ï¼‰

```javascript
const config = new GM_config(configDesc, { immediate: false }); // *æ³¨å†Œé…ç½®èœå•*
console.log(config.get("price")); // *å¯ä»¥å¼€å§‹ä½¿ç”¨äº† ğŸ‰*
```

### æŸ¥è¯¢/ä¿®æ”¹/æšä¸¾é…ç½®

å½“ä½ æ³¨å†Œäº†ä¸€ä¸ªé…ç½®èœå•åï¼Œä½ å°±å¯ä»¥é€šè¿‡è°ƒç”¨ `.get(prop)`, `.set(prop, value)` ä»¥åŠ `.list(path)` åˆ†åˆ«æ¥æŸ¥è¯¢/ä¿®æ”¹/æšä¸¾é…ç½®ã€‚ä¾‹å¦‚ï¼š

```javascript
console.log(config.get("price")); // *æŸ¥è¯¢é…ç½®*
config.set("price", 100); // *ä¿®æ”¹é…ç½®* (èœå•é¡¹ä¼šè‡ªåŠ¨æ›´æ–°)
console.log(config.list("someFolder.folder")); // *æšä¸¾ someFolder.folder ä¸‹çš„é…ç½®é¡¹*
```

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ `config.proxy` æ¥æŸ¥è¯¢/ä¿®æ”¹/æšä¸¾é…ç½®ã€‚ä¾‹å¦‚ï¼š

```javascript
console.log(config.proxy.price); // *æŸ¥è¯¢é…ç½®*
config.proxy.price = 100; // *ä¿®æ”¹é…ç½®* (èœå•é¡¹ä¼šè‡ªåŠ¨æ›´æ–°)
// *æšä¸¾ someFolder.folder ä¸‹çš„é…ç½®é¡¹*
for (const [prop, value] of Object.entries(config.proxy.someFolder.folder)) {
    console.log(prop, value);
}
console.log(Object.keys(config.proxy.someFolder.folder));
```

ç”±äº id ä¸­ä¸å…è®¸å‡ºç° `.` å­—ç¬¦ï¼Œä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆè®¿é—®ï¼š

```javascript
console.assert(config.proxy["someFolder.folder"].nothing === config.proxy.someFolder.folder.nothing);
```

### ç›‘å¬é…ç½®çš„æŸ¥è¯¢/ä¿®æ”¹

ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ `config.addEventListener(type, listener, options?)` æ¥ç›‘å¬é…ç½®çš„æŸ¥è¯¢/ä¿®æ”¹ï¼š

```javascript
config.addEventListener("set", (e) => {
    console.log(e.detail); // *é…ç½®è¢«ä¿®æ”¹*
});
config.addEventListener("get", (e) => {
    console.log(e.detail); // *é…ç½®è¢«æŸ¥è¯¢*
});
```

`e.detail` å¯¹è±¡çš„å±æ€§å¦‚ä¸‹ï¼š

- `prop`ï¼šè¢«æŸ¥è¯¢/ä¿®æ”¹çš„é…ç½®é¡¹çš„ idã€‚ä½¿ç”¨å¥ç‚¹è¡¨ç¤ºåµŒå¥—çš„é…ç½®é¡¹ã€‚
- `before`ï¼šå˜æ›´å‰çš„å€¼ã€‚
- `after`ï¼šå˜æ›´åçš„å€¼ã€‚
- `remote`ï¼šè¡¨åæ­¤ä¿®æ”¹æ˜¯å¦ç”±å…¶å®ƒè„šæœ¬å®ä¾‹é€ æˆçš„ï¼Œ`get` äº‹ä»¶ä¸­æ­¤å±æ€§æ€»ä¸º `false` (æ— æ³•æ£€æµ‹å…¶å®ƒè„šæœ¬å®ä¾‹è·å–é…ç½®)ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- `get` äº‹ä»¶ä»…åœ¨å½“å‰è„šæœ¬å®ä¾‹è·å–é…ç½®æ—¶è§¦å‘
- `set` äº‹ä»¶ä¼šåœ¨ *ä»»æ„æ¥æº* ä¿®æ”¹é…ç½®æ—¶è§¦å‘ï¼Œè€Œè¿™ä½¿å¾—å¤šæ ‡ç­¾é¡µåŒæ­¥æˆä¸ºå¯èƒ½

æ­£å¦‚ä½ æ‰€æƒ³ï¼Œä½ å¯ä»¥é€šè¿‡ `config.removeEventListener(type, listener, options?)` æ¥ç§»é™¤ç›‘å¬å™¨ã€‚è¿™ä¸¤ä¸ªæ¥å£å°±æ˜¯ä» [`EventTarget.addEventListener`](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener) å’Œ [`EventTarget.removeEventListener`](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/removeEventListener) ç»§æ‰¿è€Œæ¥çš„ã€‚

è¿™ä¸ªåŠŸèƒ½å¸¸ç”¨äºåœ¨é…ç½®å˜åŒ–æ—¶å®æ—¶æ›´æ–°è„šæœ¬çš„åŠŸèƒ½ã€‚åœ¨åº“å†…éƒ¨ï¼Œè‡ªåŠ¨æ›´æ–°èœå•é¡¹çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡è¿™ä¸ªåŠŸèƒ½æ¥å®ç°çš„ã€‚

### ç¼–ç¨‹å¼æ–‡ä»¶å¤¹å¯¼èˆª

æ‚¨å¯ä»¥è°ƒç”¨ `config.up()` å’Œ `config.down(name)` æ¥åœ¨æ–‡ä»¶å¤¹çš„å±‚æ¬¡ç»“æ„ä¸­å¯¼èˆªï¼Œè°ƒç”¨ `config.currentPath` æ¥è·å–å½“å‰è·¯å¾„ã€‚å…·ä½“æ¥è¯´ï¼š

- `config.up()`ï¼šè¿”å›ä¸Šä¸€çº§æ–‡ä»¶å¤¹ã€‚è‹¥å½“å‰å·²ç»åœ¨æ ¹ç›®å½•ï¼Œåˆ™é‡æ–°æ³¨å†Œã€‚è¿”å›ä¸€ä¸ª `string` è¡¨ç¤ºçˆ¶æ–‡ä»¶å¤¹ï¼Œæˆ–è€… `null` è¡¨ç¤ºå½“å‰å·²ç»åœ¨æ ¹ç›®å½•ã€‚
- `config.down(name)`ï¼šè¿›å…¥æ–‡ä»¶å¤¹ `name`ã€‚è‹¥ `name` ä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚è¿”å› `true` è¡¨ç¤ºæˆåŠŸè¿›å…¥æ–‡ä»¶å¤¹ï¼Œå¦åˆ™ `false`ã€‚
- `config.currentPath`ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒæŒ‰ç…§ä»æ ¹ç›®å½•åˆ°å½“å‰æ–‡ä»¶å¤¹çš„é¡ºåºæ’åˆ—ã€‚æ³¨æ„ï¼šè¿™ä¸ªå±æ€§æ˜¯åªè¯»çš„ã€‚

### æ€»ç»“ï¼šä¿®æ”¹é…ç½®é¡¹è¿‡ç¨‹

1. ç”¨æˆ·ç‚¹å‡»èœå•é¡¹
2. å°† `prop.name` å’Œå½“å‰å€¼ä½œä¸ºå‚æ•°ä¼ å…¥ `prop.input`ï¼Œè·å–ç”¨æˆ·è¾“å…¥å€¼
3. å°†ç”¨æˆ·è¾“å…¥å€¼ä½œä¸ºå‚æ•°ä¼ å…¥ `prop.processor`ï¼Œè·å–å¤„ç†åçš„å€¼
4. ä¿å­˜å¤„ç†åçš„å€¼
5. å‘å‡ºå¯¹åº” `detail` çš„äº‹ä»¶
6. æ›´æ–°èœå•é¡¹ï¼ˆè¢«ä¸Šè¿°äº‹ä»¶è§¦å‘ï¼‰

### æ€»ç»“ï¼šæ“ä½œ `config.proxy` ä¸ `config` çš„å¯¹æ¯”

| æ“ä½œ | `config` | `config.proxy` |
| --- | --- | --- |
| æŸ¥è¯¢é…ç½® | `config.get("price")` | `config.proxy.price` |
| ä¿®æ”¹é…ç½® | `config.set("price", 100)` | `config.proxy.price = 100` |
| æšä¸¾é…ç½® | `config.list("someFolder.folder")` | `Object.keys(config.proxy.someFolder.folder)` |

åœ¨å†…éƒ¨ï¼Œæ‰€æœ‰å¯¹ `config.proxy` çš„æ“ä½œéƒ½ä¼šæ˜ å°„åˆ°å¯¹ `config` çš„æ“ä½œã€‚

## ğŸ‘€ å®Œæ•´çš„ä¾‹å­

å®‰è£… [æ­¤æµ‹è¯•ä»£ç ](./test_config.user.js)ï¼Œè§‚å¯Ÿå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼›æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥å®‰è£… [Greasy Fork Enhance](https://greasyfork.org/scripts/467078) æ¥ä½“éªŒè¿™ä¸ªåº“çš„åŠŸèƒ½ã€‚

## âš ï¸ æ³¨æ„

è¿™ä¸ªé¡¹ç›®æ­£å¤„äºæ—©æœŸå‘å±•é˜¶æ®µï¼Œæ¥å£å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœä½ æœ‰å»ºè®®æˆ–è€…åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ï¼Œæ¬¢è¿æå‡º issue æˆ–è€… PRã€‚
